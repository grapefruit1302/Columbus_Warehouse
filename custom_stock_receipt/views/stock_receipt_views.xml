<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Search view для фільтрів на One2many полі -->
        <record id="view_stock_receipt_documents_line_search" model="ir.ui.view">
            <field name="name">stock.receipt.documents.line.search</field>
            <field name="model">stock.receipt.documents.line</field>
            <field name="arch" type="xml">
                <search string="Фільтри приходу">
                    <field name="number" string="Номер" filter_domain="[('number', 'ilike', self)]"/>
                    <field name="partner_name" string="Партнер" filter_domain="[('partner_name', 'ilike', self)]"/>
                    <field name="warehouse_name" string="Склад" filter_domain="[('warehouse_name', 'ilike', self)]"/>
                    
                    <filter string="Чернетки" name="draft" domain="[('state', '=', 'draft')]"/>
                    <filter string="Підтверджені" name="confirmed" domain="[('state', '=', 'confirmed')]"/>
                    <filter string="Виконані" name="done" domain="[('state', '=', 'done')]"/>
                    <filter string="Скасовані" name="cancel" domain="[('state', '=', 'cancel')]"/>
                    
                    <separator/>
                    <filter string="Прихідні накладні" name="receipts" domain="[('document_type', '=', 'receipt')]"/>
                    <filter string="Акти оприходування" name="disposals" domain="[('document_type', '=', 'disposal')]"/>
                    <filter string="Повернення з сервісу" name="returns" domain="[('document_type', '=', 'return')]"/>
                    
                    <separator/>
                    <filter string="За сьогодні" name="today" domain="[('date', '>=', context_today()), ('date', '&lt;=', context_today())]"/>
                    <filter string="За тиждень" name="week" domain="[('date', '&gt;=', (context_today() - datetime.timedelta(days=7)).strftime('%Y-%m-%d'))]"/>
                    <filter string="За місяць" name="month" domain="[('date', '&gt;=', (context_today() - datetime.timedelta(days=30)).strftime('%Y-%m-%d'))]"/>
                    
                    <group expand="0" string="Групувати за">
                        <filter string="Типом документа" name="group_document_type" context="{'group_by': 'document_type_display'}"/>
                        <filter string="Статусом" name="group_state" context="{'group_by': 'state'}"/>
                        <filter string="Складом" name="group_warehouse" context="{'group_by': 'warehouse_name'}"/>
                        <filter string="Партнером" name="group_partner" context="{'group_by': 'partner_name'}"/>
                        <filter string="Датою" name="group_date" context="{'group_by': 'date:day'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- Form view з таблицею -->
        <record id="view_stock_receipt_dashboard_form" model="ir.ui.view">
            <field name="name">stock.receipt.dashboard.form</field>
            <field name="model">stock.receipt.dashboard</field>
            <field name="arch" type="xml">
                <form string="Прихід товарів" class="o_form_sheet_bg">
                    <sheet class="o_form_sheet" style="width: 100%; max-width: none;">
                        
                        <div class="oe_button_box" name="button_box">
                            <button name="action_create_receipt" 
                                    type="object" 
                                    class="oe_stat_button" 
                                    icon="fa-plus-circle" 
                                    string="Створити прихідну накладну"/>
                            <button name="action_create_disposal" 
                                    type="object" 
                                    class="oe_stat_button" 
                                    icon="fa-plus-square" 
                                    string="Створити акт оприходування"/>
                            <button name="action_create_return" 
                                    type="object" 
                                    class="oe_stat_button" 
                                    icon="fa-reply" 
                                    string="Створити повернення з сервісу"/>
                        </div>
                        
                        <div class="oe_title">
                            <h1>Прихід товарів</h1>
                        </div>
                        
                        <!-- Інформація про фільтри -->
                        <group col="4" string="Фільтри">
                            <field name="filter_date_from"/>
                            <field name="filter_date_to"/>
                            <field name="filter_document_type"/>
                            <field name="filter_state"/>
                            <field name="filter_warehouse_id"/>
                        </group>
                        
                        <!-- Налаштування відображення -->
                        <group col="4" string="Налаштування відображення">
                            <field name="show_partner"/>
                            <field name="show_warehouse"/>
                            <field name="show_total_qty"/>
                            <field name="show_total_amount"/>
                            <field name="show_created_by"/>
                            <field name="show_posting_time"/>
                        </group>
                        
                        <!-- Кнопки дій -->
                        <group col="4" string="Дії">
                            <button name="action_apply_filters" type="object" string="Переглянути всі документи" class="btn-primary"/>
                            <button name="action_reset_filters" type="object" string="Скинути фільтри" class="btn-secondary"/>
                            <button name="action_export_to_excel" type="object" string="Експорт в Excel" class="btn-info"/>
                            <button name="action_quick_create" type="object" string="Швидке створення" class="btn-success"/>
                        </group>
                        
                        <!-- Статистика -->
                        <group col="4" string="Статистика">
                            <field name="total_documents" readonly="1"/>
                            <field name="total_receipts" readonly="1"/>
                            <field name="total_disposals" readonly="1"/>
                            <field name="total_returns" readonly="1"/>
                            <field name="total_draft" readonly="1"/>
                            <field name="total_posted" readonly="1"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- List view для документів -->
        <record id="view_stock_receipt_documents_line_list" model="ir.ui.view">
            <field name="name">stock.receipt.documents.line.list</field>
            <field name="model">stock.receipt.documents.line</field>
            <field name="arch" type="xml">
                <list string="Всі документи приходу" 
                      create="false" 
                      edit="false" 
                      delete="false"
                      decoration-info="state=='draft'"
                      decoration-warning="state=='confirmed'"
                      decoration-success="state in ['done', 'posted']"
                      decoration-muted="state=='cancel'"
                      sample="1">
                    
                    <field name="document_type_display" string="Тип операції"/>
                    <field name="number" string="Номер"/>
                    <field name="date" string="Дата"/>
                    <field name="partner_name" string="Партнер/Сервіс"/>
                    <field name="warehouse_name" string="Склад"/>
                    <field name="total_qty" string="Кількість" sum="Загалом"/>
                    <field name="amount_formatted" string="Вартість"/>
                    <field name="created_by" string="Створено"/>
                    <field name="posting_time_display" string="Час проведення"/>
                    <field name="state" string="Статус" widget="badge"
                        decoration-info="state=='draft'"
                        decoration-warning="state=='confirmed'"
                        decoration-success="state in ['done', 'posted']"
                        decoration-danger="state=='cancel'"/>
                    
                    <!-- Приховані поля для роботи -->
                    <field name="document_type" invisible="1"/>
                    <field name="document_id" invisible="1"/>
                    <field name="state_display" invisible="1"/>
                    <field name="total_amount" invisible="1"/>
                    <field name="posting_datetime" invisible="1"/>
                    <field name="state_color" invisible="1"/>
                    
                    <!-- Кнопки дій -->
                    <button name="action_open_document"
                            type="object"
                            string="Відкрити"
                            class="btn-primary"
                            icon="fa-external-link"/>
                    <button name="action_duplicate_document"
                            type="object"
                            string="Копіювати"
                            class="btn-secondary"
                            icon="fa-copy"/>
                    <button name="action_print_document"
                            type="object"
                            string="Друк"
                            class="btn-info"
                            icon="fa-print"/>
                    <button name="action_post_document"
                            type="object"
                            string="Провести"
                            class="btn-success"
                            icon="fa-check"
                            invisible="state != 'draft'"/>
                    <button name="action_cancel_document"
                            type="object"
                            string="Скасувати"
                            class="btn-danger"
                            icon="fa-times"
                            invisible="state == 'cancel'"/>
                </list>
            </field>
        </record>

        <!-- Дія для відображення всіх документів у вигляді таблиці -->
        <record id="action_stock_receipt_all_documents" model="ir.actions.act_window">
            <field name="name">Всі документи</field>
            <field name="res_model">stock.receipt.documents.line</field>
            <field name="view_mode">list</field>
            <field name="view_id" ref="view_stock_receipt_documents_line_list"/>
            <field name="search_view_id" ref="view_stock_receipt_documents_line_search"/>
            <field name="target">current</field>
            <field name="context">{'search_default_today': 1, 'create_documents': True}</field>
            <field name="domain">[]</field>
        </record>

        <!-- Дія для зведеної сторінки (форма з фільтрами) -->
        <record id="action_stock_receipt_dashboard" model="ir.actions.act_window">
            <field name="name">Прихід</field>
            <field name="res_model">stock.receipt.dashboard</field>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_stock_receipt_dashboard_form"/>
            <field name="target">current</field>
        </record>
    </data>
</odoo>